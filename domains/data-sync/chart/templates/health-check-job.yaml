apiVersion: batch/v1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: "* * * * *"
  jobTemplate:
    spec:
      backoffLimit: 0
      template:
        spec:
          containers:
          - name: health-check
            image: '{{ .Values.healthCheck.image.name }}:{{ .Values.healthCheck.image.tag }}'
            imagePullPolicy: IfNotPresent
            command:
              - /bin/sh
              - -c
              - curl -v --connect-timeout 10 --fail $DATAHUB2ENDPOINT
            envFrom:
              - configMapRef:
                  name: {{ required "api config map is required" .Values.apiConfigMapName }}
{{- if .Values.envFrom }}
{{- toYaml .Values.envFrom | nindent 14 }}
{{- end }}
          restartPolicy: Never
